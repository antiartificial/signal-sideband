# Signal Events & How We Use Them

Signal Sideband listens to the signal-cli WebSocket and turns raw Signal protocol events into a searchable, browsable intelligence layer for your group chat. Here's what we capture and why.

## Message Events

### Incoming Messages (`dataMessage`)

Every message someone sends to the group arrives as a `dataMessage` envelope. We extract:

- **Text content** — stored with full-text search indexing and OpenAI vector embeddings for semantic search. Find any conversation from months ago with a vague "that thing about kubernetes" query.
- **Sender identity** — phone number + UUID, resolved to a friendly alias via the contact system. Know who said what without memorizing phone numbers.
- **Group context** — group ID association. The `FILTER_GROUP_ID` setting ensures only your target group is captured — no DMs, no other chats leaking in.
- **Attachments** — metadata saved immediately, files downloaded asynchronously by the media worker. Images get AI vision analysis (via xAI/Grok) so you can search photos by what's in them.
- **URLs** — automatically extracted from message text, with link previews fetched in the background. Never lose that article someone dropped in chat at 2am.

### Outgoing Messages (`syncMessage.sentMessage`)

Messages you send from any device arrive as sync messages. Same extraction pipeline — your own messages are searchable too, marked as outgoing so the UI renders them in the familiar chat bubble style.

### Disappearing Messages (`expiresInSeconds`)

Signal's disappearing message timer is respected. When a message arrives with `expiresInSeconds`, we compute `expires_at = now() + duration` and store it. The **Reaper** background worker runs every minute, deleting expired messages and their media files from disk. Your group's privacy settings are honored — nothing lingers past its expiration.

### Remote Deletes (`remoteDelete`)

When someone uses "Delete for Everyone" in Signal, we receive a `remoteDelete` event referencing the original message's timestamp. The message, its attachments, thumbnails, and extracted URLs are all removed immediately. The goal isn't surveillance — it's making conversations surfaceable while respecting everyone's intent.

### View-Once Media (`viewOnce`)

View-once messages are flagged but not given special treatment in the current pipeline. They follow the same expiration rules as any other message.

## What We Build From Events

### Digests

Daily or on-demand summaries generated by an LLM (xAI Grok, Claude, or OpenAI). Multiple "lenses" available — get a straight newsletter, a Lord of the Rings chronicle, Confucian wisdom, or a South Park take on your group's conversations. Digests capture topics, decisions, action items, and a quote of the day.

### Daily Insights

Automated daily analysis that surfaces:
- **Overview** — what the group talked about today
- **Themes** — tagged topics for at-a-glance browsing
- **Quote of the Day** — the most memorable message
- **Superlatives** — who sent the most messages, who shared the most links, who's the night owl

### Cerebro Knowledge Graph

Every 6 hours, an LLM extracts concepts (topics, people, places, media, events, ideas) and their relationships from recent messages. Over time this builds a navigable knowledge graph of everything your group discusses. Concepts get enriched with context from Perplexity and Grok.

### Media Gallery

All shared images, videos, and files organized in a searchable gallery. AI vision analysis means you can search "sunset" or "whiteboard" and find the right photo. Thumbnails generated automatically.

### Nano Banana of the Day

A Gemini-generated artistic image inspired by the day's conversation themes. Pure whimsy. Every group chat deserves its own daily artwork.

## Privacy Design

- **Group filtering** — `FILTER_GROUP_ID` ensures only one group is captured. Everything else is silently dropped before storage.
- **Disappearing messages** — honored via the Reaper. Expired = deleted from DB + disk.
- **Remote deletes** — honored immediately. Delete for everyone means delete for sideband too.
- **No forwarding** — sideband is read-only. It never sends messages, reactions, or receipts back to Signal.
- **Local-first** — runs on your own hardware. No cloud services beyond the LLM APIs you choose to configure. Your conversations stay on your metal.
