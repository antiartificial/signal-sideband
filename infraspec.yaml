app: signal-sideband
role: webserver
port: 3001
healthcheck: /health
deploy: true
hosts:
  external: sideband.slopistry.com
  internal: signal-sideband-service
build:
  dockerfile: Dockerfile
services:
  postgres:
    database: signal_sideband
    extensions:
      - vector
secrets:
  - AUTH_PASSWORD
  - OPENAI_API_KEY
  - XAI_API_KEY
  - GEMINI_API_KEY
  - SIGNAL_URL
  - SIGNAL_API_URL
  - SIGNAL_NUMBER
env:
  LLM_PROVIDER: xai
  DATABASE_URL: postgres://norn:norn@host.minikube.internal:5432/signal_sideband?sslmode=disable
  DB_HOST: host.minikube.internal
  DB_USER: norn
  DB_PASSWORD: norn
  DB_NAME: signal_sideband
  DB_PORT: "5432"
  API_PORT: "3001"
  MEDIA_PATH: /data/media
  FILTER_GROUP_ID: group.dmNUVGNFalVjQ003VWd6ZHF3NW54dCtQNkswaHhzMjBGQjh6cFRKemliST0=
volumes:
  - name: media
    mountPath: /data/media
    size: 5Gi
migrations:
  command: for f in migrations/*.sql; do psql -U norn -d signal_sideband -f "$f"; done
  database: signal_sideband
artifacts:
  retain: 3
replicas: 1
alerts:
  window: 5m
  threshold: 3
repo:
  url: http://gitea.default.svc.cluster.local:3000/norn/signal-sideband.git
  branch: master
  autoDeploy: true
