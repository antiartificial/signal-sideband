name: signal-sideband
deploy: true

repo:
  url: http://host.docker.internal:3000/norn/signal-sideband.git
  branch: master
  autoDeploy: true
  repoWeb: http://localhost:3000/norn/signal-sideband

build:
  dockerfile: Dockerfile

processes:
  web:
    port: 3001
    command: ./signal-sideband
    health:
      path: /health
    scaling:
      min: 1
    resources:
      cpu: 200
      memory: 256

secrets:
  - AUTH_PASSWORD
  - OPENAI_API_KEY
  - XAI_API_KEY
  - GEMINI_API_KEY
  - SIGNAL_URL
  - SIGNAL_API_URL
  - SIGNAL_NUMBER

migrations: for f in migrations/*.sql; do psql -U norn -d signal_sideband -f "$f"; done

env:
  LLM_PROVIDER: xai
  DATABASE_URL: postgres://norn:norn@host.docker.internal:5432/signal_sideband?sslmode=disable
  DB_HOST: host.docker.internal
  DB_USER: norn
  DB_PASSWORD: norn
  DB_NAME: signal_sideband
  DB_PORT: "5432"
  API_PORT: "3001"
  MEDIA_PATH: /data/media
  FILTER_GROUP_ID: vcTTcEjUcCM7Ugzdqw5nxt+P6K0hxs20FB8zpTJzibI=

infrastructure:
  postgres:
    database: signal_sideband

endpoints:
  - url: https://sideband.slopistry.com

volumes:
  - name: signal-sideband-media
    mount: /data/media
